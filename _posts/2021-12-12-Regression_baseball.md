---
layout: single
title: "한국 프로야구에서 회귀분석을 통한 승리와 타자 기록간의 상관관계 분석 및 시각화" #제목
categories: "coding" #카테고리설정
tag: [python] #테그
---

본 데이터 분석은 Google colab을 이용하여 분석하였습니다.

# 1. 서론

## 1.1) 연구 배경

 야구라는 종목이 기록의 스포츠라고 불리는 만큼 데이터가 아주 많은 스포츠 종목 중 하나인데, 야구 관람을 즐기다 자연스럽게 데이터분석이라는 분야에까지 흥미를 느끼게 되었다. 이것이 흥미에만 그치지 않고, 데이터분석이라는 분야를 직업으로 삼고 싶었다. 그래서 통계학과에 진학하게 되었고, 통계학과 관련된 여러 강의를 수강하면서 이론을 정립해나갔다. 하지만 실생활에 있는 데이터들을 직접 분석해 본 적은 한 번도 없었다. 그러던 중 이번에 ‘컴퓨팅사고와 데이터분석 기초’ 강의를 수강할 기회가 생겼고, 직접 데이터를 분석해 볼 수 있는 기회가 생겼다. 어떤 것을 분석해볼지 고민하다가, 이번이 첫 데이터분석이기 때문에 이 분야를 공부하게 된 이유인 야구 분야에 대해 분석해 보기로 결심하였다.

 야구라는 종목이 현재는 기록의 스포츠로 유명하지만, 처음부터 결과를 기록해왔던 것은 아니다. 야구에서 데이터가 중요하게 여겨지기 시작한 것은 빌 제임스에 의해 도입된 Sabermerics(The Society for American Baseball Research)의 등장 이후였다. 야구 리그 중 가장 유명한 메이저리그도 과거에는 타자는 타율, 투수는 승리라는 기록을 중요하게 여겼다. 하지만 세이버 매트릭스의 등장 이후 OPS(출루율 + 장타율)와 WHIP(이닝당 출루 허용률)과 같은 기록 즉, 득점과 실점에 크게 영향을 주는 기록들이 중요하게 여겨지고 있다. 과거 ‘머니볼’이라는 영화와, 최근 방영한 드라마 ‘스토브리그’를 통해서 한국 야구팬들에게도 야구 분야에서 데이터분석이 얼마나 중요한지 알려지고 있다. 한국 프로야구 KBO에서도 과거에는 타율과 승리와 같은 기록을 중요시했지만, 현재는 구단마다 중요하게 여기는 기록들을 분석하여 승부의 결과를 바꾸고 있다. 이렇게 프로야구에서 데이터분석은 중요도가 점점 높아지고 있다. 
 
 오늘날 데이터분석이 중요해진 만큼 한국에서도 프로야구 기록을 저장하고 분석하는 통계 사이트가 많이 등장하고 있다. 대표적으로 ‘statiz’, ‘kboreport’가 있다. 이 두 사이트의 데이터를 이용해서 데이터분석을 해보려 한다.
 
![[그림 1] kboreports의 승률, 득점, 실점 데이터](/assets/images/regression_blog/승률 득점 실점.PNG)

**[그림 1] kboreports의 승률, 득점, 실점 데이터**


 위 데이터는 kboreports를 통해 얻은 데이터이다. pov가 승률, rs가 득점, ra가 실점이다. 이를 통해 피타고리안 승률을 계산할 것인데, 피타고리안 승률은 을 통해 계산할 수 있다. 피타고리안 승률, 득점, 실점과 실제 승률에 대한 각각의 산점도를 확인해보겠다.

![[그림 2] 피타고리안 승률과 승률의 산점도](/assets/images/regression_blog/산점도.PNG)

**[그림 2] 피타고리안 승률과 승률의 산점도**


 피타고리안 승률과 실제 승률의 산점도를 보았을 때, 두 변수에 큰 상관관계가 있다는 것을 확인할 수 있다. 그러나 이번 분석에서 확인해 볼 것은 승리와 타자 기록간의 상관관계를 확인하는 것이므로, 득점과 실점으로 계산되는 피타고리안 승률에서 실점 부분은 타자 기록과 관계가 없다는 것을 알 수 있다. 따라서 피타고리안 승률이 아닌 득점과 승률의 상관관계를 확인해보아야한다. 위 [그림 3]에서 득점과 실제 승률에 대한 산점도를 확인해보면 어느정도 두 변수간에 상관이 있다는 것을 확인할 수 있다. 따라서 득점이 실제 승률에 영향을 준다고 할 수 있다. 따라서 승리와 타자기록의 관계를 분석하기 위해 본론에서 득점과 타자 기록에 대한 상관관계를 분석할 것이다.

## 1.2) 연구 수행 방향
 야구에는 누적 데이터와 비율 데이터가 있다. 타석 수가 많아질수록 득점 수는 올라갈 확률이 높기 때문에, 득점에 관한 분석을 할 때, 타율과 같은 비율 데이터와 득점의 상관관계를 파악하는 것은 부적절한 분석이라고 할 수 있다. 하지만 비율 데이터가 필요 없는 데이터라고 할 수는 없다. 야구에서 아웃 카운트는 제한되어 있고 들어갈 수 있는 타석이 제한되어 있다. 따라서 그 타석에서 최고의 결과를 만들어 내야 한다. 따라서 이번 연구에서는 득점과 누적 데이터의 상관관계, Wrc+(조정 득점 생산력)과 비율 데이터의 상관관계를 확인해 볼 것이다.
 이 분석을 실행하기 위해 회귀 분석을 참고할 것이다. 회귀 분석이란 1개 혹은 그 이상의 예측변수의 반응변수에 대한 영향을 추정할 수 있게 해주는 통계적 방법 중 하나이다. 회귀 분석을 참고하여 작성자 본인이 만든 알고리즘은 다음과 같다.

![[그림 3] 알고리즘](/assets/images/regression_blog/알고리즘.PNG)

**[그림 3] 연구에서 사용될 알고리즘**



# 2. 본론
## 2.1) 득점과 타자의 누적기록 간의 회귀 분석

### 2.1.1) 데이터 선택 과정

![[그림 4] 스탯티즈를 통해 얻은 데이터 출력 결과](/assets/images/regression_blog/스탯티즈 데이터.PNG)

**[그림 4] 스탯티즈를 통해 얻은 데이터 출력 결과**


 본 연구에 사용된 데이터는 다음과 같다. 위 데이터는 statiz에서 얻을 수 있었다.

### 2.1.2) 득점과 관계가 있는 데이터 선별, 처리
 먼저 득점은 누적 기록이기 때문에, 비율로 이루어진 데이터를 선별하는 것은 옳지 않다. 따라서 위 데이터에서, 득점과 상관이 있다고 생각한 누적 데이터는 안타, 2루타, 3루타, 홈런, 루타, 볼넷, 사구, 삼진, 병살로 총 9개의 변수를 사용할 것이다. 하지만 여기서 안타 개수에 2루타, 3루타, 홈런이 포함이 되고, 루타 기록에는 안타부터 홈런까지의 기록이 모두 포함된다. 이런 경우 예측변수들 간의 공선성이 존재한다고 할 수 있다. 공선성이 존재하면 통계적으로 좋은 모델을 만들 수 없기 때문에, 공선성을 제거해주기 위해서 안타 수를 순수 1루타 수로 변환시켜주고, 루타 기록은 삭제하도록 하겠다. 안타 개수를 순수 1루타 수로 변환시켜주는 코드는 다음과 같다. 또한 사용하지 않는 데이터도 제거해주도록 하겠다.

![[그림 5] 전처리 데이터](/assets/images/regression_blog/전처리 데이터.PNG)

**[그림 5] 전처리 된 데이터**

### 2.1.3) 득점과 예측 변수들 간의 회귀 모형 만들기
 회귀 분석을 사용할 때, 예측변수를 한 개만 사용하는 단순 회귀 분석에서는 각 모수의 값들을 계산할 수 있지만, 예측변수가 2개 이상인 경우 컴퓨터 프로그램을 통해서 모수의 값과 p-value를 구해야 한다. 따라서 구글 코랩에서 회귀 분석을 사용할 수 있도록 해주는 ‘statsmodels.formula.api’를 이용하도록 하겠다. 위 방법을 이용한 코드와 코드로 얻은 회귀식은 다음과 같다.

![[그림 6] 득점 회귀식](/assets/images/regression_blog/득점 회귀식.PNG)

**[그림 6] 분석을 통해 얻은 회귀 모형**


### 2.1.4) 회귀 모형이 적합한지 확인
 위 결과에서 coef 의 값이 각 예측변수들의 모수이다. 모수란 해당 예측변수들의 값이 한 단위 증가했을 때, 반응변수의 변화량이다. 예를 들어 이 모형에서는 안타 개수가 1개 늘어나면 득점은 0.4648점이 늘어난다고 해석할 수 있다. 회귀 모형에서는 선형성을 만족해야 하는데 이를 R-squared 값으로 확인할 수 있다. 위 회귀 모형에서는 R-squared 값이 0.968로 선형성을 만족하는 것을 볼 수 있다.


![[그림 7] 득점상관계수](/assets/images/regression_blog/득점 상관계수.PNG)

**[그림 7] 득점과 예측변수들의 상관계수**
또한 모수의 값이 유의 한지 확인해야 하는데, 상관계수를 통해 확인 할 것이다. 3루타의 경우 모수가 홈런보다 크게 나타나는데, 3루타와 사구는 발생 횟수가 적고 상관계수가 작기 때문에 유의하지 않다고 판단할 수 있고, 삼진과 병살은 반응변수가 득점이기 때문에 상관계수가 음의 값이어야 한다. 따라서 두 변수는 상관관계가 유의하지 않다고 판단할 수 있다.


### 2.1.5) 수정된 회귀 모형
 수정된 회귀 모형의 결과와 시각화한 자료는 다음과 같다. 

![[그림 8] 득점 회귀식2](/assets/images/regression_blog/득점 회귀식2.PNG)

**[그림 8] 수정된 회귀 모형**

![[그림 9] 회귀식 시각화](/assets/images/regression_blog/회귀식의 시각화.PNG)

**[그림 9] 다중 회귀 모형의 시각화**


 위 결과를 보았을 때, 회귀 모형이 잘 적합된 것을 확인할 수 있고, 시각화한 모형을 보았을 때, 1루타, 2루타, 홈런, 볼넷 이 4가지 변수들이 득점과 상관이 있다는 것을 확인할 수 있다.
 그러나 위 모형의 한계점이 드러나는 것을 볼 수 있다. 예를 들어 수정하기 전 회귀 모형에서는 3루타의 가치가 홈런의 가치보다 높게 평가되고 있다. 그러나 절대적으로 3루타의 가치는 홈런의 가치보다 높을 수 없다. 이렇게 모형 적합이 된 이유는 3루타의 발생빈도가 홈런보다 매우 낮기 때문이다. 실제로  값을 계산해보면 약 0.2에 가까운 값이 나온다. 누적 데이터만 사용한 위 회귀 모형만으로는 득점에 대한 영향력을 정확하게 설명하기 어렵다. 
 

## 2.2) Wrc+와 타자의 비율기록 간의 회귀 분석
 위 결과처럼 누적 데이터로만 결과를 예측하기는 어려웠다. 따라서 이번에는 비율 데이터인 Wrc+에 대한 회귀 분석을 해볼 것이다. Wrc+는 Weighted Runs Created+의 약자로 타자의 조정 득점 생산성을 의미하고 현재 존재하는 타격 스탯중 가장 정확한 타격 스탯으로 여겨지고 있다. 또한 평균의 개념을 기저에 깔고 있다. Wrc+의 기본값은 100으로 리그 평균 득점 생산성을 의미하고, 만약 Wrc+ 값이 110이면 리그 평균보다 10% 생산성이 좋다고 해석할 수 있다. Wrc+는 기록하는 기업에 따라 방법이 다르고, 계산 방법 또한 공개되어있지 않는다. 여러 가지 계산법 중 가장 신뢰받고 있는 statiz의 Wrc+를 분석해 볼 것이다. 그러면 지금부터 Wrc+에 관한 회귀 분석을 하도록 하겠다.

### 2.2.1) 데이터 선택 과정
 득점에 대한 회귀 분석을 했을 때의 데이터에 Wrc+에 대한 데이터와 각 비율 데이터가 입력되어 있으므로 다른 데이터를 추가하지 않고 그대로 사용할 것이다.


### 2.2.2) Wrc+와 관계가 있는 데이터 선별, 처리
 먼저 Wrc+가 비율 스탯이기 때문에, 누적으로 이루어진 데이터와 사용하지 않을 데이터를 제거해준다. 하지만 누적 데이터 중 타자의 득점 생산성에 영향을 줄 수 있는 병살타 항목을 타석수로 나누어서 ‘병살%’라는 변수를 만들어 주었다. 여기서 Wrc+와 상관이 있다고 생각한 타율, 출루율, 장타율, OPS, HR%, BB%, K%, 병살% 총 8개의 변수를 사용할 것이다. 그러나 OPS의 계산 방법이 출루율과 장타율을 더하는 것이므로 OPS에 공선성이 존재하므로 OPS변수를 제거하고, 타율과 BB%, HR% 또한 출루율과 장타율에 반영이 되어 있다. 따라서 세 변수도 제거한 후에 회귀 분석을 실시하도록 하겠다. 

![[그림 10] 전처리 데이터](/assets/images/regression_blog/전처리 데이터 2.PNG)

**[그림 10] 전처리 된 데이터**


### 2.2.3) Wrc+와 예측 변수들 간의 회귀 모형 만들기

![[그림 11] Wrc 회귀식](/assets/images/regression_blog/wrc 회귀식.PNG)

**[그림 11] Wrc+와 예측변수들의 회귀 모형** 


 먼저 데이터 이름에서 특수문자를 인식 못하여, 데이터 명을 바꾸어 주었다. 위 회귀모형은 반응변수를 Wrc+, 예측변수를 출루율, 장타율, 병살율로 설정한 회귀 모형이다.

### 2.2.4) 회귀 모형이 적합한지 확인
 위 모형에서 병살율의 검정통계량이 낮게 나온 것을 확인할 수 있다. 따라서 병살율이 모형에 적절하지 않다고 의심할 수 있고, 그것을 확인하기 위해 Wrc+와 병살율의 산점도를 확인해보겠다.

![[그림 12] 산점도1](/assets/images/regression_blog/산점도 1.PNG)

**[그림 12] 병살율과 Wrc+의 산점도**

![[그림 13] 산점도2](/assets/images/regression_blog/산점도 2.PNG)

**[그림 13] 출루율, 장타율과 Wrc+의 산점도**


 병살율과 Wrc+의 산점도를 확인해보았을 때, 점이 무작위로 찍힌 것처럼 보인다. 따라서 병살율과 Wrc+는 상관관계가 없다고 판단할 수 있다. 또한 장타율을 색깔로 표현하고 출루율과 Wrc+의 산점도를 찍은 [그림 14]을 보았을 때는 출루율과 장타율이 Wrc+와 상관관계가 있다는 것을 확인할 수 있다. 따라서 예측 변수 병살율을 제거하고 다시 모형 적합을 해야 한다. 또한 wOBA가 예측 변수로 추가되어도 괜찮은지 판단하기 위해 Wrc+와 각 예측 변수들의 상관계수를 구해보았다.

![[그림 14] 상관계수](/assets/images/regression_blog/상관계수 wrc.PNG)

**[그림 14] Wrc+와 예측 변수들의 상관계수**


 위 상관계수 값을 보았을 때 병살율과 Wrc+의 상관계수는 매우 낮은 것을 확인할 수 있고, wOBA는 다른 예측 변수들에 비해 상대적으로 상관계수가 높은 것을 확인할 수 있다. 하지만 wOBA값이 출루율과 장타율을 통해서 계산되기 때문에, 공선성이 생길 우려가 있으므로 최종적으로 Wrc+와 출루율, 장타율의 회귀 모형을 만들기로 결정했다.


### 2.2.5) 수정된 회귀 모형
 수정된 Wrc+의 회귀 모형은 아래와 같다.

![[그림 15] 수정된 회귀모형](/assets/images/regression_blog/wrc 최종 회귀식.PNG)


**[그림 15] 수정된 회귀 모형**


 위 회귀 모형에 대한 분석과 예측은 결론에서 다루도록 하겠다.


# 3. 결론
 먼저 득점에서 안타, 2루타, 홈런, 볼넷에 대한 회귀 모형을 만들었다. 이 모형을 해석하자면, 다른 예측변수들이 고정되어 있을 때, 1루타의 개수가 1개 증가하면 득점량은 0.4005만큼 증가한다고 해석할 수 있다. 마찬가지로 다른 예측 변수들이 고정되어 있을 때, 2루타, 홈런, 볼넷이 각각 1개 증가하면 득점은 0.6701, 1.3369, 0.2680만큼 증가한다고 해석할 수 있다. 예를들어 어떤 팀이 1루타를 835개, 2루타를 190개, 홈런을 106개, 볼넷을 523개를 얻었다면, 득점의 기댓값은
가 나오게 된다. 위 데이터는 0번째 행의 데이터를 사용한 것이고, 실제 득점이 611점으로 실제 득점과 회귀 분석을 통한 기대 득점이 유사하게 나타나는 것을 확인할 수 있다.

 다음으로 Wrc+에서 출루율, 장타율에 대한 회귀 모형을 해석하겠다. 이 모형을 해석하면 다른 변수들이 고정되어 있을 때, 출루율이 0.001 증가하면 Wrc+값은 2.658529만큼 증가한다고 해석할 수 있고, 다른 변수들이 고정되어 있을 때, 장타율이 0.001 증가하면 Wrc+값이 0.726207만큼 증가한다고 해석할 수 있다. 위와 마찬가지로 0번째 행의 데이터를 입력해주면,
의 기대 Wrc+ 값이 나오는데, 실제 Wrc+값인 93.4보다 크게 나타나는 것을 볼 수 있다. 그 이유는 Wrc+ 값이 구장에 따른 보정 값이 들어가는데, 그 데이터를 제공하지 않아서 고려하지 못했기 때문에 이러한 오차가 발생했다고 분석했다. 

 이번 분석을 통해서 승률에 영향을 미치는 타자의 기록은 득점과 상관이 있는 변수들이고, 누적 데이터, 비율 데이터로 구분하여 누적 데이터인 득점에는 변수 1루타, 2루타, 홈런, 볼넷이 영향을 준다는 것을 확인했고, 비율 데이터인 Wrc+에 영향을 주는 변수는 출루율과 장타율 두 변수가 중요하다는 것을 알 수 있었다. 또한 그 변수들이 반응 변수에 얼마나 영향을 주는지도 분석할 수 있었다.


# 4. 참여후기 
 이번 과제가 스스로 데이터를 분석해볼 수 있는 기회라고 생각했다. 처음에는 무작정 데이터를 입력하여 분석을 진행하려 했지만, 쉽게 분석이 진행되지 않았다. 그래서 자료를 분석할 순서와 알고리즘을 먼저 만들고 다시 분석을 진행하니 처음보다 수월하게 진행된다는 것을 느꼈다. 데이터를 분석하는 것 자체도 중요한 부분이지만, 내가 어떤 데이터를 분석하고, 어떤 목적을 가지고 있는지, 어떠한 방법으로 분석을 진행할 것인지 먼저 생각하고 알고리즘을 짜는 것이 얼마나 중요한 부분인지 깨닫게 되는 활동이었다.

 또한 야구 분야의 기록을 분석하는 것이 처음에는 간단하고 쉬울 것이라고 생각했다. 하지만 생각보다 과정이 복잡하였고, 회귀 분석에서의 가정이 맞지 않는 경우가 많았다. 이론적으로 강의를 수강했을 때는 데이터에 대한 가정이 어느정도 되어 있지만, 실제 데이터는 그렇지 않았다. 공선성이 존재하는 경우가 많았고, 선형성을 따르지 않거나, 샘플의 개수가 부족한 데이터들도 존재했다. 이번 활동을 통해서 실습으로 이론과 응용하는 법을 조금 더 이해할 수 있었고 파이썬 코딩 능력이 향상되었다고 느꼈다. 




# 5. 참고문헌

[1. kboreport | 프로야구 시즌 승률과 총 득점, 총 실점 데이터(2015 ~ 2021)](http://www.kbreport.com/statBuzz/main){: .btn .btn--info}
<br>

[2. 피타고리안 승률(pythagorean expectation)은 왜 정확할까?](http://suxism.com/?p=3973){: .btn .btn--info}
<br>

[3. statiz | 프로야구 팀별 득점과 각 타격 데이터(1982 ~ 2021)](http://www.statiz.co.kr/stat.php?opt=0&sopt=0&re=0&ys=2021&ye=2021&se=0&te=&tm=&ty=0&qu=auto&po=0&as=&ae=&hi=&un=&pl=&da=2&o1=WRCPLUS&de=1&o2=WAR_ALL&lr=5&tr=&cv=&ml=1&sn=30&si=&cn=){: .btn .btn--info}
<br>

[4. statsmodels.formula.api | 구글 코랩에서 회귀 분석을 가능하게 해주는 사이트](https://www.statsmodels.org/dev/api.html){: .btn .btn--info}
<br>


