---
layout: single
title: "LMISA: A lightweight multi-modality image segmentation network via domain adaptation using gradient magnitude and shape constraint" #제목
excerpt : ""
categories: 
    - deeplearningCV #카테고리설정
tag: 
    - ["CV","CNN", 'medical'] #테그

date: 2024-12-10
last_modified_at: 2024-12-10
classes: wide    
---


[LMISA: A lightweight multi-modality image segmentation network via domain adaptation using gradient magnitude and shape constraint](https://pdf.sciencedirectassets.com/272154/1-s2.0-S1361841522X00054/1-s2.0-S1361841522001839/main.pdf?X-Amz-Security-Token=IQoJb3JpZ2luX2VjEP7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLWVhc3QtMSJHMEUCIQCV%2BYH47URMLB2rQkJG1PDg8hSjfJRNr0C7XzrJnoTMJQIgF65uqbIqjmSOhDR12IcJsbz2Dg8eRG9UZXQu%2FzVUHhMquwUIt%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAFGgwwNTkwMDM1NDY4NjUiDI7rCQUReDhQ8KHXVCqPBRZvfybBxIxBynF5dmF8jZXKN2gqT%2FqXeFfYUmr2l2a4T0uEgYY2HlhNneOilkjk9QcMgE3xxE92ToYsd2SBD1IPbjxlcS3QjafgSL1AK3FaRWuyfUdvUu5Zz%2FKVnqNKb92wW9jkPqxtbyXcrkgRcFvCpfKXMFeetZFPOXIOeQxUnAYD2Q6nbdCDSExpRSJiQKj4peDVosWgbN6nQ0l4vWoLPbP7vvXpF8NJ%2FXdqin64eQO8AOixKKo2b38Aktr2KBA4J7hOhBm5aQRyWGSv%2BCDdPYYf7mcSGBlLeMK7guqseWCzcQ4svVI2e5BMFHZSLyB5IAw9MN6dIi8K6MP5mYIKUbszQvJefUubywzgtIPCDQvMLNPBsdjZlZhPFmp9OThoPo%2BZXYXC4eZqBTPs5SyggTYGfJVilh4m0SrwGtAIbs2FyqsXGA1qJYvIx7%2FRWpM8HTtwI%2B5wnClAUa4%2BmVHzUDp3Ph85Pbywg0TkStvNjMAPuwqhFOUfcRk4mVAq4aI5hldyJKqb8QUCUiKKNmQHev2J6ATb993TYks8MgH9mE9xRWMgYJF%2FSQpmmAAOnOtb0BySMdrF0Jd%2FbxjKyIqFoP4TjZLlEWtjdTLQ9LgyTjyc9YuDXdwqRimFYpNxMmF4x%2BXT1qaKPZesrbxtSv%2FaKffyKDPAllkDNpDMKXE8XyPYWU6FkqRa0%2FbCbOUIww0ROoiNbPDeJ51hDhqWA0bcsyEc2pVws7DCB%2B5YNhC%2FFZeIILtvGNyf%2BqvhGA3xvW3ki5ReLpD0Sp2GkKL1EbdgoGOCOZDIEgUoZmGKa%2BCF14D%2BUae987f8kwa8hxNn012KAC8bkdYygWN5vJiE7GZqHK5LUCCL9EWrAT5WGWswp%2FfpugY6sQEtTny2Aw2Itq10R%2Fsglsq0cXBYZm12nMUGNsjD5HgAxT%2FXMh2GFKLK%2FbC84FUrcMDdqwD%2BJ5VK%2FF7QxXKxSOlrFbXEoLHo0%2BQnVdw5jvvjcXhSBqvDnbNk%2BQDvM%2BqxgIqkxtsJ%2BLlSIx7GNNZzFFkdnvwJjuOTtdj0f7mL07oyOZlA%2FtjN370SOweORR%2BKMNnwKQsdPv5PGkAjyIYxLOhe70XjnoLeS8t%2FrIf7WCW98kI%3D&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Date=20241212T064655Z&X-Amz-SignedHeaders=host&X-Amz-Expires=300&X-Amz-Credential=ASIAQ3PHCVTY6TIYLGXZ%2F20241212%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Signature=fa8739b33299703b61b75b223a5731c8510a785e22483ea909607cdc6a589304&hash=18f3666578adc5460d999aa23a731d470e31d9d4761bbbb42023dd394c386214&host=68042c943591013ac2b2430a89b270f6af2c76d8dfd086a07176afe7c76c2c61&pii=S1361841522001839&tid=spdf-ce0142f8-23d1-4cdd-9cc4-187590e616bd&sid=4af51b623063e440728a7ff242b750701015gxrqa&type=client&tsoh=d3d3LnNjaWVuY2VkaXJlY3QuY29t&ua=0d125e0256000c575a50&rr=8f0bc29308a6d1ef&cc=kr){: .btn .btn--primary}


# 0. Abstract

&nbsp;&nbsp; medical image segmentation에서는 각 image modality(CT, MRI 등)마다 intensity(강도)와 distribution(분포)가 매우 다양하고 다르게 분포되어 있다. 그렇게 때문에 한가지 modality(source domain)로만 학습한 모델을 다른 modality에 적용시켰을 때, 성능이 저하되는 문제가 있었다. 이 논문은 이를 해결하기 위해서 하나의 modality label만을 사용하여 label이 존재하지 않는 다른 modality(target domain)에 효과적으로 적용할 수 있는 end-to-end multi-modality image segmentation을 제안한다. 


## 주요 단어

1. source domain(label O)
2. target domain(label X)
3. model : Multi-resolution Locally Normalized Gradient Magnitude(MLNGM) : CT, MRI domain을 같은 gradient latent feature representation으로 표현(as the network learns a consistent latent feature representation with shape awareness from both domains)



# 1. Introduction

## Supervised deep learning models
- 두 가지 성공 요인:
  1. **sufficient amount of annotated data**
  2. **train & test data가 가은 분포로 부터 나옴**

## Medical image의 한계점
  - annotated data가 수집되기 위해서 전문 인력이 사용되어야 하므로 높은 cost 발생
  - 다양한 modality, scanner, protocal에 따라 데이터 분포가 많이 다르기 때문에, 한가지 모델로 여러 modality에 적용시키기 어려움
  - 각 병원 및 환자들이 다른 modality를 사용하기 때문에, 일반화하는 것 연구가 필요

## 목적
- 논문에서는 **source domain**의 image label만을 사용하여 **다양한 domain(source 및 target)**에서 image를 segmentation 하는 **generalized model**을 생성해야한다.

---

## 기존 연구와 한계

1. **multi domain image segmentation
   - target domain image를 추가 input channel로 사용하여 두 domain의 정보를 합친다.
   - **한계**: **supervised learning** 기반이며, source와 target domain의 **co-registered image**가 필요함.
2. **source 데이터에서 pre-trained된 모델을 target 데이터에 fine-tuning**:
   - **한계**: target domain의 대규모 annotated data가 필요함.

### Unsupervised Domain Adaptation
- 최근 연구들은 **unsupervised domain 적응**에 주목:
  - annotated data 부족 문제 해결
  - **domain shift** 문제를 극복.
- 주요 방법론:
  1. **Generative Models**:
     - GAN, Auto-Encoder
  2. **기타**:
     - Discrepancy-based methods
     - Self-ensembling methods
     - Adversarial learning, Cycle consistency
     - Disentanglement strategies


그러나 이런 경우에는 complex한 모델을 사용하고 adversarial learning을 사용하기 때문에 큰 computing적으로 큰 비용이 발생한다는 한계점이 존재한다.

---

## LMISA(논문의 기법)

### Idea
- 논문에서는 간단하고 효과적인 framwork를 제안한다.
  1. **Multi-Resolution Locally-Normalized Gradient Magnitude, MLNGM** 기법을 통한 전처리:
     - domain 간 **appearance discrepancies**를 제거.
  2. **hybrid-network** 사용:
     - image reconstruction과 image segmentation을 포함하여 두 domain의 **joint latent representation**을 학습.
  3. **Shape Constraint(제약)** 추가:
     - adversarial learning에서 target domain의 예측 segmentation 결과와 source domain의 label을 비교.
     - 물체의 general shape 보존과 background에서의 **false positive** 제거

     
### Eval. Dataset
1. **KiTS19 (MICCAI Challenge 2019)**: kidney(신장(**CT**)) dataset.
2. **local MRI dataset**: kidney(**MRI**) dataset.
3. **MMWHS (Multi-Modality Whole Heart Segmentation Challenge 2017)**:
   - cardiac(심장), kidney(**MRI, CT**) dataset.

- 모델 train은 CT를 source domain, MRI를 target domain으로 설정하고 반대로도 평가.

---

## Contribute

1. **efficient end-to-end domain adaptation network**:
   - 단순한 전처리 단계(MLNGM)와 **형상 제약(Shape Constraint)** 결합.
2. **두 가지 segmentation 작업**:
   - kidney(binary class) 및 cardiac(multi class) segmentation 실험.
   - **모듈별 성능 분석(ablation study)**을 통해 각 요소의 효과 검증.
   - 새로운 target domain에서도 **model retraining 없이** 높은 segmentation 성능 달성.
3. **효율성**:
   - 적은 memory 사용
   - 2D, 3D image에 모두 적용 가능
---


# 2. Related Works

domain adaptation을 해결하기 위해 다양한 방법들이 제안 되었는데 이 중 Image-level Adaptation과 Feature-level Adaptation을 다룬다.

---

## 1. Image-Level Adaptation
- **CycleGAN** image-to-image translation을 통해 domain 간 분포를 remapping:
  - source domain의 분포를 target domain으로 translation하거나 반대 과정을 거침
  - domain 간 **pixel level 차이**를 줄이는 것이 목적
- **한계**:
  - pixel level approach는 두 domain의 **marginal distribution**를 줄이는 것에 초점을 두기 때문에 semantic consistency가 부족하다. 이를 해결하기 위해 제약 조건을 추가하는 논문이 제시되었다.
      - **Hoffman et al. (2018):** Semantic consistency loss 추가.
      - **Zhang et al. (2018a, 2018b):** Shape constraints 추가.

그러나 이방법은 memory 사용량이 매우 크기 때문에 시간적인 부분에서 많은 시간이 소요된다는 한계점이 존재한다.


---

## 2. Feature-Level Adaptation
- source와 target domain의 **latent feature space**을 일치시키는(unified) 방법:
  - **domain 불변 특징(domain-invariant features)**을 학습.
  - 주요 방법:
    - **Adversarial Learning**(Tzeng et al., 2017; Tsai et al., 2018).
    - **Cross-Domain Reconstruction**(Ghifary et al., 2016).
    - **Divergence Minimization**(Rozantsev et al., 2018; Bhushan Damodaran et al., 2018).

### 의료 영상에서의 활용
1. **PnP-AdaNet(Dou et al., 2018)**:
   - source domain으로 학습된 초기 인코더 레이어를 target 훈련 시 교체.
   - target 훈련에서는 고차원 레이어를 고정하여 재사용.
   - **한계점**: 두 개의 판별자(discriminator)와 세 단계의 훈련이 필요해 시간 소모가 큼.
2. **DAPNet(Hou et al., 2019)**:
   - 다중 해상도의 특징 수준 및 이미지 수준 손실을 사용해 domain 변화 해결.
   - 특징 수준 손실은 두 domain의 공간적 불일치를 최소화.
   - 이미지 수준 손실은 두 domain의 색상 및 스타일 차이를 최소화.
3. **Wu and Zhuang (2020, 2021)**:
   - domain 불일치를 계산하는 새로운 메트릭 제안.
   - **VAE(Variational Autoencoder)** 기반 네트워크로 두 domain의 잠재 특징 분포를 공통 확률 분포로 근사.

### 통합 접근법
- **SIFA (Chen et al., 2020)**:
  - 이미지 및 특징 수준을 동시에 정렬하는 엔드투엔드 방법.
  - target 데이터의 외형으로 source 이미지를 translation(Cycle Consistency Loss 사용).
  - 세 개의 판별자(discriminator)를 사용해 학습.

---

## 3. Content-Style Disentanglement (형상-스타일 분리)
- 의료 이미지를 **형상 공간(content space)**과 **스타일 공간(style space)**으로 분리:
  - **Pei et al. (2021)**:
    - domain 불변(domain-invariant) 및 domain 특화(domain-specific) 특징으로 분리.
    - **Self-Attention Module**, Cycle Consistency, 여러 판별자를 활용.
    - **한계점**: 네트워크가 복잡해 다중 domain 확장이 어려움.

---

## 4. 한계 및 연구 필요성
- 기존 방법의 주요 한계:
  - **복잡한 네트워크 구조**와 다양한 손실 함수로 인해:
    - **메모리 소모**가 크고, 3D 이미지를 처리하기 위한 훈련 시간이 매우 길어짐.
    - 네트워크 훈련 시 **파라미터 조정**이 어려움.
- 본 연구의 목표:
  - 단순하면서도 효과적이고 정확한 방법론을 개발하여 특히 3D 의료 이미지에서의 **크로스 모달리티 이미지 분할** 문제를 해결.
